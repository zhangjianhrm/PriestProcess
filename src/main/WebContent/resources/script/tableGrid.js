(function(a){a.fn.extend({tableGrid:function(e){e=jQuery.extend({mode:"list",template:"",mtype:"post",colNames:[],url:"",caption:"",urlData:{},colModel:[],showpage:true,isCheckbox:{is:false},showViewNum:true,rowNum:10,rowList:[10,20,30],nowPage:1,altRows:true,success:null,failure:null},e);if(e.colNames.length!=e.colModel.length&&e.colNames.length<1&&e.colModel.length<1&&url==""){alert("\u914d\u7f6e\u4fe1\u606f\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5");return false}jQuery(this).css({position:"relative"});var b="tbGrid-"+new Date().getTime(),k=jQuery('<div class="jGrid-mask"></div><table class="jGrid-table" id="'+b+'"><caption></caption><thead><tr></tr></thead><tbody class="jGrid-body"><tr><td class="first-load"></td></tr></tbody><tfoot><tr><td><div class="pagebar"></div></td></tr></tfoot></table>');if(e.caption!=""){k.find("caption").html(e.caption).show()}if(e.colNames.length>0){var g=k.find("thead > tr");if(!!e.isCheckbox.is){var j=jQuery('<input type="checkbox" class="all-selector" value="'+e.isCheckbox.name+'"/>');j.css({"vertical-align":"middle"}).click(function(){tbGrid=jQuery("#"+b);if(!!this.checked){tbGrid.find("tbody :checkbox").attr("checked",true)}else{tbGrid.find("tbody :checkbox").attr("checked",false)}});var c=jQuery('<th style="text-align:center; width: 50px;"><label>\u5168\u9009</label></th>');c.appendTo(g);j.prependTo(g.find("th").first())}jQuery.each(e.colNames,function(q){var o=jQuery.extend({width:"auto",align:"left"},e.colModel[q]);var n=o.align,m='style="';m+="text-align:"+n+";";m+="width: "+o.width+'"';var p=jQuery("<th "+m+"></th>");p.html(e.colNames[q]);p.appendTo(g)})}if(!!e.isCheckbox.is){k.find(".first-load").attr("colspan",e.colModel.length+1)}else{k.find(".first-load").attr("colspan",e.colModel.length)}k.find(".first-load").height(200);jQuery(this).html(k);d(this,e.nowPage);function d(o,p){if(p==0){return false}var n=jQuery(o).find(".jGrid-mask");n.show().css({opacity:0.7,height:jQuery(o).innerHeight()-2,width:jQuery(o).width()-2});if(isNaN(parseInt(p,10))){e.nowPage=1}e.nowPage=parseInt(p,10);if(!!e.showpage){var m=jQuery.extend({page:e.nowPage,rowNum:e.rowNum},e.urlData)}else{var m=e.urlData}var m=jQuery.extend(m,f(e.url));jQuery.ajax({type:e.mtype,url:e.url,dataType:"json",data:m,success:function(r){jQuery(o).find("tbody.jGrid-body").empty();if(r==undefined||r==""||r==null){jQuery(o).find("tfoot td").hide();var q=jQuery("<tr></tr>").appendTo(jQuery(o).find("tbody"));q.html('<td><div class="table-err">\u8bf7\u6c42\u5931\u8d25</div></td>').find("td").attr("colspan",e.colModel.length);n.hide();e.failure&&e.failure();return false}var s=r.total;if(s>0){var t=r.rows;jQuery.each(t,function(w){var y=t[w];var v=jQuery("<tr></tr>").appendTo(jQuery(o).find("tbody.jGrid-body"));if(e.mode=="list"){if(!!e.isCheckbox.is){var u=jQuery('<td style="text-align:center; width: 50px;" class="jGrid-td listMode "><input type="checkbox" name="'+e.isCheckbox.name+'" value="'+y[e.isCheckbox.name]+'" id="id_'+y[e.isCheckbox.name]+'"/></td>');u.appendTo(v)}jQuery.each(e.colModel,function(D){var C=jQuery.extend({width:"auto",align:"left"},e.colModel[D]);var B=C.align,z='style="';z+="text-align:"+B+";";z+="width: "+C.width+'"';var A=jQuery("<td "+z+"></td>").appendTo(v);A.html(y[C.name]);A.attr("class","J_"+C.name+" jGrid-td listMode ")})}else{var x=jQuery('<td class=" jGrid-td "></td>');if(!!e.isCheckbox.is){x.attr("colspan",e.colModel.length+1)}else{x.attr("colspan",e.colModel.length)}x.html(tmpl(e.template,y));x.appendTo(v)}});if(!!e.altRows){jQuery(o).find("tbody.jGrid-body > tr:nth-child(even)").addClass("odd");jQuery(o).find("tbody.jGrid-body > tr").bind("mouseover mouseout",function(){jQuery(this).toggleClass("over")}).live("click",function(){if(jQuery(this).hasClass("selected")){jQuery(this).removeClass("selected")}else{jQuery(this).siblings("tr.selected").removeClass("selected");jQuery(this).addClass("selected")}})}if(!!e.isCheckbox.is){jQuery(o).find("tfoot td").attr("colspan",e.colModel.length+1)}else{jQuery(o).find("tfoot td").attr("colspan",e.colModel.length)}if(!!e.showpage){h(o,e.nowPage,s)}else{jQuery(o).find("tfoot").hide()}}else{jQuery(o).find("tfoot td").hide();var q=jQuery("<tr></tr>").appendTo(jQuery(o).find("tbody"));q.html('<td><div class="table-norec">\u65e0\u6570\u636e</div></td>').find("td");if(!!e.isCheckbox.is){q.find("td").attr("colspan",e.colModel.length+1)}else{q.find("td").attr("colspan",e.colModel.length)}}n.hide();e.success&&e.success(o,r)},error:function(r){jQuery(o).find("tbody").empty();jQuery(o).find("tfoot td").hide();var q=jQuery("<tr></tr>").appendTo(jQuery(o).find("tbody"));q.html('<td><div class="table-err">\u8bf7\u6c42\u5931\u8d25</div></td>').find("td").attr("colspan",e.colModel.length);n.hide();e.failure&&e.failure(r)}})}function f(p){var o=new Array();var q={};o=p.split("?");if(o.length<=1){return q}var m=o[1].split("&");for(i=0;i<m.length;i++){var n=m[i].split("=");q[n[0]]=n[1]}return q}function h(n,u,q){var o=q/e.rowNum;if(isNaN(parseInt(u))){u=1}if(isNaN(parseInt(o))){o=1}if(u<1){u=1}if(o<1){o=1}if(u>o){u=o}u=Math.ceil(u);o=Math.ceil(o);var w="",r=u-1,v=u+1;if(!!e.showViewNum){w+='<div class="sizer"><span class="explain">\u6bcf\u9875\u663e\u793a\u6570\u91cf</span>';jQuery.each(e.rowList,function(x){w+='<a href="#" data:view="'+e.rowList[x]+'">'+e.rowList[x]+"</a>"});w+="</div>"}w+='<div class="pager"><span class="explain">\u5171'+q+"\u6761\u8bb0\u5f55</span>";if(r<1){w+='<a href="#" title="\u5df2\u662f\u6700\u524d\u4e00\u9875" data:page="0" class="page-prev page-prev-disabled">\u5df2\u662f\u6700\u524d\u4e00\u9875</a>'}else{w+='<a href="#" title="\u4e0a\u4e00\u9875" data:page="'+r+'" class="page-prev">\u4e0a\u4e00\u9875</a>'}if(u==1){w+='<a href="#" title="\u7b2c 1 \u9875" data:page="1" class="active"><span>1</span></a>'}else{w+='<a href="#" title="\u7b2c 1 \u9875" data:page="1"><span>1</span></a>'}if(u>3){var t=u-3}else{var t=1}if(t>(o-6)&&(o-6)>0){var t=(o-6)}if(t>1){w+='<span class="page-break">...</span>'}for(var p=t+1;p<t+6;p++){if(p>=o){break}if(p==u){w+='<a href="#" title="\u7b2c '+p+' \u9875" data:page="'+p+'" class="active"><span>'+p+"</span></a>"}else{w+='<a href="#" title="\u7b2c '+p+' \u9875" data:page="'+p+'"><span>'+p+"</span></a>"}}if(o>t+6){w+='<span class="page-break">...</span>'}if(o>1){if(u==o){w+='<a href="#" title="\u7b2c '+o+' \u9875" data:page="'+o+'" class="active"><span> '+o+" </span></a>"}else{w+='<a href="#" title="\u7b2c '+o+' \u9875" data:page="'+o+'"><span> '+o+" </span></a>"}}if(v>o){w+='<a href="#" title="\u5df2\u662f\u6700\u540e\u4e00\u9875" data:page="'+o+'" class="page-next page-next-disabled">\u5df2\u662f\u6700\u540e\u4e00\u9875</a>'}else{w+='<a href="#" title="\u4e0b\u4e00\u9875" data:page="'+v+'" class="page-next">\u4e0b\u4e00\u9875</a>'}w+='<span class="explain">\u5230\u7b2c</span> <input type="text" id="page" class="pagenum" maxlength="4"/> <span class="explain">\u9875</span><a href="#" class="confirm-btn" ><span>\u786e\u5b9a</span></a>';w+="</div>";jQuery(n).find("tfoot .pagebar").html(w);jQuery(n).find(".pager a").bind("click",function(){if(!jQuery(this).hasClass("active")){d(n,jQuery(this).attr("data:page"))}return false});jQuery(n).find(".pager a.confirm-btn").unbind().bind("click",function(){l(n,jQuery(n).find(".pager .pagenum").val(),o);return false});jQuery(n).find(".pager .pagenum").keypress(function(x){if(x.keyCode==13){l(n,jQuery(this).val(),o)}});if(!!e.showViewNum){var m=jQuery(n).find(".sizer a");for(var p=0,s=m.length;p<s;p++){if(jQuery(m[p]).attr("data:view")==e.rowNum){jQuery(m[p]).addClass("active")}}jQuery(n).find(".sizer a").bind("click",function(){if(!jQuery(this).hasClass("active")){e.rowNum=jQuery(this).attr("data:view");d(n,1)}return false})}}function l(n,o,m){if(isNaN(parseInt(o))){o=1}if(isNaN(parseInt(m))){m=1}if(o<1){o=1}if(m<1){m=1}if(o>m){o=m}o=parseInt(o,10);d(n,o)}}})})(jQuery);